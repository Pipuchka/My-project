import asyncio
import aiosqlite
import os
from dotenv import load_dotenv

# Загрузка переменных окружения
load_dotenv()
DB_NAME = os.getenv("DB_NAME", "acm_med_bot.db")

async def initialize_database():
    # Подключение к базе данных
    async with aiosqlite.connect(DB_NAME) as db:
        # Создаем таблицу, если её нет
        await db.execute('''
            CREATE TABLE IF NOT EXISTS qa (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                question TEXT UNIQUE,
                answer TEXT,
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                answered_by TEXT DEFAULT 'system',
                last_used TIMESTAMP,
                use_count INTEGER DEFAULT 0,
                user_id INTEGER
            )
        ''')

        # Вставляем данные
        await db.executemany('''
            INSERT OR IGNORE INTO qa (question, answer, answered_by)
            VALUES (?, ?, ?)
        ''', [
            ('Что такое АСМ-Мед?', 'ООО "АСМ-МЕД" - медицинская компания, специализирующаяся на дистрибуции медицинских изделий и оборудования от производителей России, стран ЕАЭС и Европы. Основные партнеры: FREBOR, ACCOMEДИКА, MEDIVICE, МедАльянс, Интероко, ТОРMED, МЕДИМКОМ, TIK, SMD.', 'system'),
            ('Какие преимущества у АСМ-Мед?', 'Компания предлагает: высококвалифицированный сервис, демократичные цены, индивидуальный подход к клиентам, полное сопровождение сделки от заявки до доставки.', 'system'),
            ('Кто основные клиенты АСМ-Мед?', 'Компания ориентирована на удовлетворение потребностей ЛПУ (лечебно-профилактических учреждений) и партнеров через поставку качественных изделий по конкурентоспособным ценам.', 'system'),
            ('Какой юридический адрес АСМ-Мед?', '128626, Москва, проспект Мира, д. 102, к. 1, помещение 3/7', 'system'),
            ('Где находится офис АСМ-Мед?', 'Фактический адрес: г. Москва, проспект Мира, д. 101в, стр. 2', 'system'),
            ('Где находится склад АСМ-Мед?', 'Склад расположен по адресу: г. Москва, Остаповский проезд, 15к2', 'system'),
            ('Какой телефон АСМ-Мед?', 'Контактный телефон: +7(495)199-47-97', 'system'),
            ('Какой email АСМ-Мед?', 'Электронная почта: info@asm-med.ru', 'system'),
            ('Каков график работы АСМ-Мед?', 'Пн-Пт с 09:00 до 18:00, Сб-Вс - выходной', 'system'),
            ('Какие товары производит FREBOR?', 'Ассортимент FREBOR включает: колпачки "Луер", инфузионные системы, сильфоны для дренажа, зажимы пуповины, диализаторы, мочеприемники, зонды желудочные и аспирационные катетеры.', 'system'),
            ('Какие инфузионные системы есть у FREBOR?', 'FREBOR предлагает: систему инфузионную ПР-01, подогреваемые инфузионные системы, универсальные трансфузионно-инфузионные системы.', 'system'),
            ('Есть ли у FREBOR продукты для диализа?', 'Да, в ассортименте: капиллярные диализаторы, магистрали кровопроводящие диализные, иглы диализные.', 'system'),
            ('Какие дренажные системы у FREBOR?', 'FREBOR производит сильфоны для активного дренажа однократного применения.', 'system'),
            ('Какие дыхательные контуры представлены?', 'Ассортимент включает контуры: без влагосборника, с одним влагосборником, с двумя влагосборниками, неонатальные (10м), коаксиальные.', 'system'),
            ('Для каких процедур используются дыхательные контуры?', 'Дыхательные контуры применяются в анестезиологии и реанимации, подключении к аппаратам ИВЛ.', 'system'),
            ('Какие товары для анестезиологии представлены?', 'В ассортименте: дыхательные мешки типа "AMBУ", дыхательные фильтры, кислородные маски, ларингеальные маски, дыхательные маски.', 'system'),
            ('Что такое мешок дыхательный типа "AMBУ"?', 'Это реанимационный мешок для ручной вентиляции легких при проведении реанимационных мероприятий.', 'system'),
            ('Какие виды медицинских катетеров представлены?', 'Ассортимент включает: хирургические дренажные, кислородные, дуоденальные питающие и отсосные, ректальные, отсосные с контролем уровня вакуума, желудочные зонды, катетеры Нелатона, Тимана.', 'system'),
            ('Что такое катетер Нелатона?', 'Это урологический катетер для кратковременной катетеризации мочевого пузыря.', 'system'),
            ('Для чего нужен катетер Тимана?', 'Катетер Тимана используется для катетеризации мочевого пузыря у мужчин при стриктурах уретры.', 'system'),
            ('Какие мочеприемники представлены?', 'В ассортименте: ножные мочеприемники и прикроватные мочеприемники.', 'system'),
            ('Чем отличаются ножные мочеприемники?', 'Ножные мочеприемники компактны, крепятся на ноге и предназначены для мобильных пациентов.', 'system'),
            ('Какие шприцы колбы есть у Парадигмы?', 'Ассортимент включает шприцы колбы для Liebel-Flarsheim, Medtron, Nemoto и MEDRAD различных конфигураций с J-линиями, T-спиралями и канюлями.', 'system'),
            ('Для каких аппаратов подходят шприцы Парадигма?', 'Шприцы совместимы с оборудованием: Optistar, Accutron CT/MR, Dual Shot/SmartShot, Vistron CT, Salient, Stellant, Spectris Solaris EP.', 'system'),
            ('Есть ли шприцы для MEDRAD?', 'Да, представлены шприцы колбы MEDRAD для Vistron CT, Salient, Stellant и Spectris Solaris EP.', 'system'),
            ('Какие ларингоскопы есть у RITMANN?', 'RITMANN производит: одноразовые LED ларингоскопы, многоразовые ларингоскопы и рукояти к ним.', 'system'),
            ('Какие клинки для ларингоскопов RITMANN доступны?', 'В ассортименте: пластиковые клинки типа Miller и Macintosh (размер 2,5 В).', 'system'),
            ('Что такое ларингоскоп типа Miller?', 'Клинок Miller имеет прямую конструкцию, оптимален для интубации пациентов с анатомическими особенностями.', 'system'),
            ('Как оформить заказ в АСМ-Мед?', 'Для оформления заказа обратитесь по телефону +7(495)199-47-97 или на email info@asm-med.ru. Специалисты компании проконтролируют весь процесс от заявки до доставки.', 'system'),
            ('Есть ли минимальная сумма заказа?', 'Информацию о минимальной сумме заказа уточняйте у менеджеров компании по контактному телефону.', 'system'),
            ('Работает ли АСМ-Мед с регионами?', 'Да, компания осуществляет поставки по всей территории России. Условия доставки уточняйте у менеджеров.', 'system'),
            ('Какие формы оплаты принимает АСМ-Мед?', 'Доступны различные формы оплаты, включая безналичный расчет. Подробности уточняйте у менеджеров.', 'system'),
            ('Какие системы совместимы со шприцами Парадигма?', 'Шприцы совместимы с аппаратами Liebel-Flarsheim, Medtron Accutron, Nemoto Dual Shot, MEDRAD Vistron/Salient/Stellant/Spectris.', 'system'),
            ('Какое напряжение у клинков RITMANN?', 'Клинки ларингоскопов RITMANN работают от напряжения 2,5 В.', 'system'),
            ('Из чего сделаны клинки RITMANN?', 'Клинки изготовлены из медицинского пластика и предназначены для одноразового использования.', 'system'),
            ('Предоставляет ли АСМ-Мед консультации по продукции?', 'Да, специалисты компании предоставляют профессиональные консультации по всем видам продукции.', 'system'),
            ('Есть ли техническая поддержка оборудования?', 'Компания оказывает техническую поддержку и сервисное обслуживание поставляемого оборудования.', 'system'),
            ('Какие сроки доставки в Москве?', 'Доставка по Москве осуществляется в течение 1-2 рабочих дней после оформления заказа.', 'system'),
            ('Как отследить заказ?', 'После отправки заказа менеджер предоставит трек-номер для отслеживания.', 'system')
        ])

        # Создаем индекс для ускорения поиска
        await db.execute('CREATE INDEX IF NOT EXISTS idx_qa_question ON qa(question)')
        await db.commit()
        print("✅ База данных успешно инициализирована")

if __name__ == "__main__":
    asyncio.run(initialize_database())